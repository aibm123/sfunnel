<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Credential Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --background: #111827;
            --sidebar: #1f2937;
            --border: #374151;
            --text-primary: #d1d5db;
            --text-secondary: #9ca3af;
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--background); color: var(--text-primary); }
        .nav-link { color: var(--text-secondary); transition: all 0.2s ease-in-out; border-bottom: 2px solid transparent; }
        .nav-link:hover { color: #ffffff; border-bottom-color: var(--primary-hover); }
        .nav-link.active { color: #ffffff; font-weight: 600; border-bottom-color: var(--primary); }
        .card { background-color: var(--sidebar); border: 1px solid var(--border); }
        .btn-primary { background-color: var(--primary); color: #ffffff; transition: background-color 0.2s; }
        .btn-primary:hover { background-color: var(--primary-hover); }
        .btn-primary:disabled { background-color: #1e3a8a; cursor: not-allowed; }
        .input-field { background-color: var(--border); border: 1px solid #4b5563; color: var(--text-primary); }
        .input-field:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px #2563eb60; }
        .loader { border: 4px solid #4b5563; border-top: 4px solid var(--primary); border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        table { border-collapse: collapse; width: 100%; table-layout: fixed; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid var(--border); word-wrap: break-word; vertical-align: top; }
        th { background-color: var(--border); font-weight: 600; }
        tbody tr:hover { background-color: var(--border); }
        
        .list-item { cursor: pointer; transition: background-color 0.2s; }
        .list-item:hover { background-color: #4b5563; }
        .list-item.active { background-color: var(--primary); color: white; }
        .list-item.active h3, .list-item.active p { color: white; }
        
        .article { background-color: #1f2937; padding: 1rem; border-radius: 0.5rem; border: 1px solid #4b5563; margin-bottom: 1rem; }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
        .status-published { background-color: #10b981; color: #ffffff; }
        .status-draft { background-color: #6b7280; color: #ffffff; }

        .tab-button { background-color: var(--border); color: var(--text-secondary); }
        .tab-button.active { background-color: var(--primary); color: #ffffff; font-weight: 600; }
        .toggle-switch { width: 40px; height: 20px; background-color: #4b5563; border-radius: 10px; position: relative; cursor: pointer; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background-color: white; border-radius: 50%; transition: .4s; }
        input:checked + .slider { background-color: var(--primary); transform: translateX(20px); }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 50; }
        .modal-content { background-color: var(--sidebar); padding: 2rem; border-radius: 0.5rem; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; border: 1px solid var(--border); }
        .resource-tag { background-color: #374151; color: #9ca3af; font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; display: inline-flex; align-items: center; gap: 4px; }
        
        .expandable-content { max-height: 6em; overflow: hidden; transition: max-height 0.3s ease-out; position: relative; }
        .expandable-content.expanded { max-height: 1000px; transition: max-height 0.5s ease-in; }
        .expand-btn { color: var(--primary); cursor: pointer; font-weight: 500; font-size: 0.875rem; margin-top: 4px; }
        
        .color-picker-wrapper { display: flex; align-items: center; gap: 0.5rem; background-color: var(--border); padding: 4px; border-radius: 0.375rem; border: 1px solid #4b5563;}
        .color-well { width: 2.25rem; height: 2.25rem; border: none; padding: 0; background: none; border-radius: 0.25rem; cursor: pointer; -webkit-appearance: none; }
        .color-well::-webkit-color-swatch-wrapper { padding: 0; }
        .color-well::-webkit-color-swatch { border: none; border-radius: 0.25rem; }
    </style>
</head>
<body class="h-screen">

    <!-- Login View -->
    <div id="view-login" class="flex items-center justify-center h-screen p-4">
        <div class="w-full max-w-md">
            <div class="card p-8 rounded-lg shadow-lg">
                <div class="text-center mb-8">
                    <i class="fas fa-shield-halved text-blue-400 text-5xl"></i>
                    <h1 class="text-3xl font-bold text-white mt-4">Sales Credential</h1>
                    <p class="text-gray-400">ƒêƒÉng nh·∫≠p ƒë·ªÉ b·∫Øt ƒë·∫ßu x√¢y d·ª±ng uy t√≠n.</p>
                </div>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="email" class="block text-gray-300 mb-2">Email</label>
                        <input type="email" id="email" class="input-field w-full rounded-md p-3" value="demo@credential.com">
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-gray-300 mb-2">M·∫≠t kh·∫©u</label>
                        <input type="password" id="password" class="input-field w-full rounded-md p-3" value="demo">
                    </div>
                    <p class="text-center text-sm text-gray-500 mb-4">S·ª≠ d·ª•ng t√†i kho·∫£n m·∫´u ƒë·ªÉ tr·∫£i nghi·ªám.</p>
                    <button type="submit" class="btn-primary w-full rounded-md py-3 font-semibold">ƒêƒÉng nh·∫≠p</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Container (hidden by default) -->
    <div id="app-container" class="hidden h-screen flex flex-col">
        <!-- Header / Horizontal Navigation -->
        <header class="bg-sidebar w-full p-4 shadow-md z-10">
            <div class="container mx-auto flex justify-between items-center">
                <div class="text-2xl font-bold text-blue-400">
                    <i class="fas fa-shield-halved mr-2"></i>
                    <span class="hidden sm:inline">Sales Credential</span>
                </div>
                <nav class="flex space-x-4 sm:space-x-8">
                    <a href="#" id="nav-creation" class="nav-link active py-2 px-1 sm:px-3 text-sm sm:text-base"><i class="fas fa-compass-drafting mr-2 hidden sm:inline"></i>Ki·∫øn t·∫°o</a>
                    <a href="#" id="nav-library" class="nav-link py-2 px-1 sm:px-3 text-sm sm:text-base"><i class="fas fa-folder-open mr-2 hidden sm:inline"></i>B√†i vi·∫øt</a>
                    <a href="#" id="nav-scheduler" class="nav-link py-2 px-1 sm:px-3 text-sm sm:text-base"><i class="fas fa-calendar-check mr-2 hidden sm:inline"></i>ƒê·ªãnh k·ª≥</a>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto container mx-auto">
            <!-- Creation Space View -->
            <div id="view-creation">
                 <h1 class="text-3xl font-bold text-white mb-4">Kh√¥ng gian Ki·∫øn t·∫°o</h1>
                <div class="flex border-b border-gray-700 mb-6">
                    <button class="tab-button py-2 px-4 rounded-t-md active" data-tab="creation-profile">1. ƒê·ªãnh v·ªã</button>
                    <button class="tab-button py-2 px-4 rounded-t-md" data-tab="creation-resource">2. Th∆∞ vi·ªán</button>
                    <button class="tab-button py-2 px-4 rounded-t-md" data-tab="creation-deepspy">3. Ki·∫øn th·ª©c</button>
                </div>
                <!-- Tab Content -->
                <div id="tab-content-creation-profile" class="tab-pane">
                     <div class="card p-6 rounded-lg">
                         <h2 class="text-xl font-semibold mb-2 text-white">Qu√©t Profile & ƒê·ªãnh v·ªã Guideline</h2>
                          <p class="text-gray-400 mb-4">Nh·∫≠p link Facebook ƒë·ªÉ AI ph√¢n t√≠ch v√† t·∫°o Guideline th∆∞∆°ng hi·ªáu.</p>
                          <div class="flex flex-col sm:flex-row gap-4">
                               <input id="profile-url" type="text" class="input-field w-full rounded-md p-3" placeholder="https://facebook.com/...">
                               <button id="profile-scan-btn" class="btn-primary rounded-md px-6 py-3 font-semibold whitespace-nowrap flex items-center justify-center">
                                   <i class="fas fa-crosshairs mr-2"></i><span>Qu√©t Profile</span>
                               </button>
                          </div>
                          <div id="guideline-output" class="mt-4 overflow-x-auto">
                               <table class="min-w-full">
                                   <thead><tr><th>URL</th><th>Phong c√°ch</th><th>Ch·ªß ƒë·ªÅ ch√≠nh</th><th>H√†nh ƒë·ªông</th></tr></thead>
                                   <tbody id="guideline-table-body"></tbody>
                               </table>
                          </div>
                     </div>
                </div>
                <div id="tab-content-creation-resource" class="tab-pane hidden">
                     <div class="card p-6 rounded-lg">
                         <div class="mb-8">
                             <h2 class="text-xl font-semibold mb-2 text-white">1. Nh·∫≠p Testimonial t·ª´ Kh√°ch h√†ng</h2>
                             <p class="text-gray-400 mb-4">T·∫£i l√™n ·∫£nh ch·ª•p m√†n h√¨nh tin nh·∫Øn, email... l√†m b·∫±ng ch·ª©ng uy t√≠n.</p>
                             <div class="flex flex-col sm:flex-row gap-4">
                                 <input id="testimonial-upload-input" type="file" accept="image/*" multiple class="block w-full text-sm text-gray-400 file:mr-4 file:py-3 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-gray-300 hover:file:bg-gray-600 flex-grow"/>
                                 <div class="color-picker-wrapper">
                                     <input type="color" id="testimonial-color-well" value="#10b981" class="color-well">
                                     <input type="text" id="testimonial-color-hex" value="#10b981" class="input-field w-24 p-2 rounded-md">
                                 </div>
                                 <button id="testimonial-import-btn" class="btn-primary rounded-md px-6 py-3 font-semibold whitespace-nowrap"><i class="fas fa-upload mr-2"></i>Import</button>
                             </div>
                         </div>

                         <hr class="border-gray-700 my-8">

                         <div>
                             <h2 class="text-xl font-semibold mb-2 text-white">2. T√¨m ·∫¢nh minh h·ªça t·ª´ Google</h2>
                             <p class="text-gray-400 mb-4">T√¨m ki·∫øm h√¨nh ·∫£nh ƒë·ªÉ l√†m phong ph√∫ th√™m b√†i vi·∫øt.</p>
                             <div class="flex flex-col sm:flex-row gap-4 mb-4">
                                 <input id="image-search-query" type="text" class="input-field w-full rounded-md p-3" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ ·∫£nh c·∫ßn t√¨m (vd: luxury car interior)">
                                 <div class="flex items-center gap-2">
                                     <label class="text-gray-400 whitespace-nowrap">S·ªë l∆∞·ª£ng:</label>
                                     <input id="image-search-limit" type="number" min="1" max="5" value="3" class="input-field w-20 p-2 rounded-md text-center">
                                 </div>
                                 <div class="color-picker-wrapper">
                                     <input type="color" id="image-search-color-well" value="#2563eb" class="color-well">
                                     <input type="text" id="image-search-color-hex" value="#2563eb" class="input-field w-24 p-2 rounded-md">
                                 </div>
                                 <button id="image-search-btn" class="btn-primary rounded-md px-6 py-3 font-semibold whitespace-nowrap flex items-center justify-center">
                                     <i class="fas fa-search mr-2"></i><span>T√¨m ·∫¢nh</span>
                                 </button>
                             </div>
                         </div>

                          <div id="resource-output" class="mt-4 overflow-x-auto">
                               <table class="min-w-full">
                                   <thead><tr><th>Lo·∫°i</th><th>·∫¢nh xem tr∆∞·ªõc</th><th>Ch·ªß ƒë·ªÅ / T√™n file</th><th>B√†i vi·∫øt trang c√° nh√¢n g·ª£i √Ω</th><th>H√†nh ƒë·ªông</th></tr></thead>
                                   <tbody id="resource-table-body"></tbody>
                               </table>
                          </div>
                     </div>
                </div>
                <div id="tab-content-creation-deepspy" class="tab-pane hidden">
                     <div class="card p-6 rounded-lg">
                          <div class="mb-8">
                             <h2 class="text-xl font-semibold mb-2 text-white">1. T·ª± nh·∫≠p t√†i li·ªáu PDF</h2>
                             <p class="text-gray-400 mb-4">T·∫£i l√™n c√°c t√†i li·ªáu, b√°o c√°o... l√†m ki·∫øn th·ª©c n·ªÅn.</p>
                             <div class="flex flex-col sm:flex-row gap-4">
                                 <input id="pdf-upload-input" type="file" accept=".pdf" multiple class="block w-full text-sm text-gray-400 file:mr-4 file:py-3 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-gray-300 hover:file:bg-gray-600 flex-grow"/>
                                 <button id="pdf-import-btn" class="btn-primary rounded-md px-6 py-3 font-semibold whitespace-nowrap"><i class="fas fa-upload mr-2"></i>Import PDF</button>
                             </div>
                         </div>
                         <hr class="border-gray-700 my-8">
                         <div>
                             <h2 class="text-xl font-semibold mb-2 text-white">2. Qu√©t PDF t·ª´ Google</h2>
                             <p class="text-gray-400 mb-4">T√¨m ki·∫øm c√°c b√°o c√°o, t√†i li·ªáu PDF c√¥ng khai tr√™n Internet.</p>
                              <div class="flex flex-col sm:flex-row gap-4">
                                   <input id="deepspy-query" type="text" class="input-field w-full rounded-md p-3" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ nghi√™n c·ª©u...">
                                    <div class="flex items-center gap-2">
                                     <label for="deepspy-limit" class="text-gray-400 whitespace-nowrap">S·ªë l∆∞·ª£ng:</label>
                                     <input id="deepspy-limit" type="number" min="1" max="5" value="3" class="input-field w-20 p-2 rounded-md text-center">
                                 </div>
                                 <button id="deepspy-pdf-btn" class="btn-primary rounded-md px-6 py-3 font-semibold whitespace-nowrap flex items-center justify-center">
                                      <i class="fas fa-file-pdf mr-2"></i><span>Qu√©t PDF</span>
                                   </button>
                              </div>
                         </div>
                          <div id="deepspy-output" class="mt-4 overflow-x-auto">
                               <table class="min-w-full">
                                   <thead><tr><th>Ngu·ªìn</th><th>B√†i vi·∫øt trang c√° nh√¢n g·ª£i √Ω</th><th>T√™n file</th><th>H√†nh ƒë·ªông</th></tr></thead>
                                   <tbody id="deepspy-table-body"></tbody>
                               </table>
                          </div>
                     </div>
                </div>
            </div>

            <!-- Asset Library View -->
            <div id="view-library" class="hidden">
                 <h1 class="text-3xl font-bold text-white mb-6">B√†i vi·∫øt</h1>
                 <div id="library-content">
                     <div id="library-list-view">
                         <div class="card p-6 rounded-lg mb-6">
                             <div class="flex flex-col gap-4">
                                  <input id="campaign-name" type="text" class="input-field flex-grow rounded-md p-3" placeholder="Nh·∫≠p t√™n chi·∫øn d·ªãch m·ªõi...">
                                  <select id="guideline-selector" class="input-field w-full rounded-md p-3"></select>
                                  <select id="knowledge-selector" class="input-field w-full rounded-md p-3"></select>
                                  <div class="flex items-center gap-4">
                                     <button id="create-campaign-btn" class="btn-primary rounded-md px-6 py-3 font-semibold whitespace-nowrap self-start"><i class="fas fa-plus mr-2"></i>T·∫°o Chi·∫øn d·ªãch</button>
                                     <label class="flex items-center space-x-2 text-gray-300">
                                         <input type="checkbox" id="campaign-google-search-toggle" class="form-checkbox bg-gray-800 border-gray-600 text-blue-500 h-5 w-5">
                                         <span>Duy·ªát Google Search ƒë·ªÉ g·ª£i √Ω b√†i vi·∫øt</span>
                                     </label>
                                  </div>
                             </div>
                         </div>
                         <div class="card rounded-lg overflow-hidden">
                             <div id="campaign-list" class="space-y-2 p-4"></div>
                         </div>
                     </div>
                     <div id="library-detail-view" class="hidden">
                         <!-- JS will render this -->
                     </div>
                 </div>
            </div>

            <!-- Scheduler View -->
            <div id="view-scheduler" class="hidden">
                 <h1 class="text-3xl font-bold text-white mb-6">ƒê·ªãnh k·ª≥</h1>
                 <div id="scheduler-content">
                     <div id="scheduler-list-view">
                         <div class="card p-6 rounded-lg mb-6">
                              <h2 class="text-xl font-semibold mb-2 text-white">Th√™m nhi·ªám v·ª• theo d√µi Website</h2>
                              <p class="text-gray-400 mb-4">Nh·∫≠p v√†o link web, h·ªá th·ªëng s·∫Ω ƒë·ªãnh k·ª≥ qu√©t link ƒë√≥ c√≥ g√¨ m·ªõi kh√¥ng.</p>
                              <div class="flex flex-col sm:flex-row gap-4">
                                 <input id="task-url-input" class="input-field flex-grow p-3 rounded-md" placeholder="https://www.example.com/news">
                                 <select id="task-frequency" class="input-field p-3 rounded-md">
                                     <option value="H√†ng ng√†y">H√†ng ng√†y</option>
                                     <option value="H√†ng tu·∫ßn">H√†ng tu·∫ßn</option>
                                 </select>
                                 <button id="schedule-task-btn" class="btn-primary font-semibold py-3 px-6 rounded-md">Th√™m</button>
                              </div>
                         </div>
                         <div class="card rounded-lg overflow-hidden">
                             <table class="min-w-full">
                                 <thead><tr><th>Website ƒëang theo d√µi</th><th>T·∫ßn su·∫•t</th><th>Tr·∫°ng th√°i</th></tr></thead>
                                 <tbody id="scheduled-tasks-body"></tbody>
                             </table>
                         </div>
                     </div>
                     <div id="scheduler-detail-view" class="hidden">
                         <!-- JS will render this -->
                     </div>
                 </div>
            </div>
            
            <!-- Modal for selection -->
            <div id="selection-modal" class="modal-overlay hidden">
                 <div class="modal-content">
                     <div class="flex justify-between items-center mb-4">
                         <h2 id="modal-title" class="text-xl font-semibold text-white">Ch·ªçn</h2>
                         <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                     </div>
                     <div id="modal-selection-content" class="space-y-4"></div>
                     <div class="mt-6 flex justify-end gap-4">
                         <button id="cancel-modal-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-md">H·ªßy</button>
                         <button id="save-modal-btn" class="btn-primary font-semibold py-2 px-4 rounded-md">L∆∞u</button>
                     </div>
                </div>
            </div>

             <!-- Modal for editing records -->
            <div id="edit-modal" class="modal-overlay hidden">
                 <div class="modal-content">
                     <div class="flex justify-between items-center mb-4">
                         <h2 id="edit-modal-title" class="text-xl font-semibold text-white">Ch·ªânh s·ª≠a</h2>
                         <button id="edit-close-modal-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                     </div>
                     <div id="edit-modal-form-content" class="space-y-4"></div>
                     <div class="mt-6 flex justify-end gap-4">
                         <button id="edit-cancel-modal-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-md">H·ªßy</button>
                         <button id="edit-save-modal-btn" class="btn-primary font-semibold py-2 px-4 rounded-md">L∆∞u thay ƒë·ªïi</button>
                     </div>
                </div>
            </div>

            <div id="toast" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-300"><p id="toast-message"></p></div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const loginView = document.getElementById('view-login');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');

        // --- STATE MANAGEMENT ---
        let state = { guidelines: [], deepspyResults: [], resources: [], campaigns: [], scheduledTasks: [], taskLogs: [] };
        let currentEditing = { type: null, id: null };
        let currentArticleSelection = { campaignId: null, articleId: null, type: '' };

        function loadState() {
            const defaultCampaigns = [
                { id: 1, name: 'Chi·∫øn d·ªãch Qu√Ω 4 - TƒÉng t·ªëc Chuy·ªÉn ƒë·ªïi s·ªë cho Doanh nghi·ªáp v·ª´a v√† nh·ªè', guidelineId: 'guideline-0', knowledgeId: 'deepspy-0', articles: Array.from({length: 10}, (_, i) => ({ id: 100+i, title: `B√†i ${i+1}: 5 Sai l·∫ßm ph·ªï bi·∫øn khi l·ª±a ch·ªçn gi·∫£i ph√°p CRM v√† c√°ch tr√°nh`, status: i % 2 === 0 ? 'ƒê√£ ƒëƒÉng' : 'Ch∆∞a ƒëƒÉng', schedule: '', resources: [`resource-0`], content: i === 0 ? `<p>Trong b·ªëi c·∫£nh th·ªã tr∆∞·ªùng b·∫•t ƒë·ªông s·∫£n cao c·∫•p t·∫°i TP.HCM ƒëang ng√†y c√†ng c·∫°nh tranh, The Global City n·ªïi l√™n nh∆∞ m·ªôt ƒë·∫°i ƒë√¥ th·ªã ph·ª©c h·ª£p, mang trong m√¨nh t·∫ßm v√≥c qu·ªëc t·∫ø. Tuy nhi√™n, ƒë·ªëi v·ªõi c√°c nh√† ƒë·∫ßu t∆∞ s√†nh s·ªèi, quy·∫øt ƒë·ªãnh "xu·ªëng ti·ªÅn" kh√¥ng ch·ªâ d·ª±a v√†o nh·ªØng l·ªùi qu·∫£ng c√°o hoa m·ªπ m√† c√≤n ph·ª• thu·ªôc v√†o c√°c y·∫øu t·ªë c·ªët l√µi nh∆∞ ph√°p l√Ω, ti·ªÅm nƒÉng tƒÉng gi√° v√† uy t√≠n c·ªßa ch·ªß ƒë·∫ßu t∆∞. B√†i vi·∫øt n√†y, d·ª±a tr√™n ki·∫øn th·ª©c n·ªÅn t·ª´ b√°o c√°o c·ªßa Savills Vi·ªát Nam, s·∫Ω ƒëi s√¢u ph√¢n t√≠ch nh·ªØng kh√≠a c·∫°nh n√†y.</p><p class="mt-4">Y·∫øu t·ªë ƒë·∫ßu ti√™n v√† quan tr·ªçng nh·∫•t ch√≠nh l√† ph√°p l√Ω d·ª± √°n. Theo t√†i li·ªáu ch√∫ng t√¥i thu th·∫≠p ƒë∆∞·ª£c, The Global City ƒë√£ ho√†n thi·ªán ƒë·∫ßy ƒë·ªß c√°c gi·∫•y t·ªù c·∫ßn thi·∫øt, bao g·ªìm gi·∫•y ch·ª©ng nh·∫≠n quy·ªÅn s·ª≠ d·ª•ng ƒë·∫•t v√† gi·∫•y ph√©p x√¢y d·ª±ng cho c√°c ph√¢n khu. ƒêi·ªÅu n√†y, k·∫øt h·ª£p v·ªõi uy t√≠n c·ªßa Masterise Homes - m·ªôt nh√† ph√°t tri·ªÉn b·∫•t ƒë·ªông s·∫£n h√†ng hi·ªáu c√≥ ti·∫øng, t·∫°o n√™n m·ªôt n·ªÅn t·∫£ng v·ªØng ch·∫Øc cho ni·ªÅm tin c·ªßa nh√† ƒë·∫ßu t∆∞, gi·∫£m thi·ªÉu t·ªëi ƒëa c√°c r·ªßi ro li√™n quan ƒë·∫øn ph√°p l√Ω m√† nhi·ªÅu d·ª± √°n kh√°c ƒëang v∆∞·ªõng ph·∫£i.</p><p class="mt-4">V·ªÅ ti·ªÅm nƒÉng tƒÉng gi√°, ph√¢n khu Canal District ƒë∆∞·ª£c xem l√† "tr√°i tim" c·ªßa d·ª± √°n v·ªõi h·ªá th·ªëng k√™nh ƒë√†o nh√¢n t·∫°o d√†i 2km v√† chu·ªói shophouse s·∫ßm u·∫•t. D·ª±a tr√™n ph√¢n t√≠ch so s√°nh v·ªõi c√°c khu v·ª±c t∆∞∆°ng t·ª± nh∆∞ Ph√∫ M·ªπ H∆∞ng giai ƒëo·∫°n ƒë·∫ßu, t·ª∑ su·∫•t l·ª£i nhu·∫≠n t·ª´ vi·ªác cho thu√™ v√† tƒÉng gi√° v·ªën t·∫°i ƒë√¢y ƒë∆∞·ª£c d·ª± b√°o s·∫Ω r·∫•t h·∫•p d·∫´n. Nh∆∞ m·ªôt kh√°ch h√†ng c·ªßa ch√∫ng t√¥i, anh Minh, Gi√°m ƒë·ªëc m·ªôt c√¥ng ty logistics, ƒë√£ chia s·∫ª trong m·ªôt tin nh·∫Øn: "Anh quy·∫øt ƒë·ªãnh ƒë·∫ßu t∆∞ 2 cƒÉn shophouse ·ªü ƒë√¢y sau khi xem ph√¢n t√≠ch c·ªßa em, ti·ªÅm nƒÉng khai th√°c kinh doanh v√† cho thu√™ l√† r·∫•t r√µ r√†ng."</p><img src="https://placehold.co/400x200/2563eb/FFF?text=Canal+District+View" class="rounded-lg my-4 w-full object-cover"><p class="mt-4">T√≥m l·∫°i, v·ªõi s·ª± minh b·∫°ch v·ªÅ ph√°p l√Ω, ti·ªÅm nƒÉng tƒÉng tr∆∞·ªüng v∆∞·ª£t tr·ªôi v√† ƒë∆∞·ª£c b·∫£o ch·ª©ng b·ªüi c√°c th∆∞∆°ng hi·ªáu l·ªõn, The Global City, ƒë·∫∑c bi·ªát l√† ph√¢n khu Canal District, l√† m·ªôt l·ª±a ch·ªçn ƒë·∫ßu t∆∞ ƒë√°ng c√¢n nh·∫Øc trong giai ƒëo·∫°n n√†y. C√°c nh√† ƒë·∫ßu t∆∞ n√™n t√¨m hi·ªÉu k·ªπ v√† l√†m vi·ªác v·ªõi c√°c ƒë∆°n v·ªã t∆∞ v·∫•n chuy√™n nghi·ªáp ƒë·ªÉ c√≥ ƒë∆∞·ª£c quy·∫øt ƒë·ªãnh t·ªët nh·∫•t.</p>`: null }))},
                { id: 2, name: 'Chi·∫øn d·ªãch B·∫•t ƒë·ªông s·∫£n Cao c·∫•p - Ph√¢n t√≠ch The Global City', guidelineId: 'guideline-0', knowledgeId: null, articles: Array.from({length: 10}, (_, i) => ({ id: 200+i, title: `B√†i ${i+1}: ƒê√°nh gi√° ph√°p l√Ω v√† ti·ªÅm nƒÉng tƒÉng gi√° c·ªßa ph√¢n khu Canal District`, status: 'Ch∆∞a ƒëƒÉng', schedule: '', resources: [], content: null }))}
            ];
            state.guidelines = JSON.parse(localStorage.getItem('credential_guidelines')) || [{ id: 'guideline-0', url: 'https://www.facebook.com/satyanadella', style: 'L√£nh ƒë·∫°o, T·∫ßm nh√¨n, t·∫≠p trung v√†o AI v√† s·ª± ƒë·ªìng c·∫£m', theme: 'C√¥ng ngh·ªá doanh nghi·ªáp, Tr√≠ tu·ªá nh√¢n t·∫°o, VƒÉn h√≥a t·ªï ch·ª©c', audience: 'L√£nh ƒë·∫°o doanh nghi·ªáp, Nh√† ph√°t tri·ªÉn, B√°o ch√≠ c√¥ng ngh·ªá' }];
            state.deepspyResults = JSON.parse(localStorage.getItem('credential_deepspy')) || [
                { id: 'deepspy-0', source: 'google', query: 'So s√°nh chi ph√≠ gi·ªØa AWS v√† Azure cho startup', type: 'PDF', content: `<strong>Ti√™u ƒë·ªÅ: The Global City: 3 Y·∫øu T·ªë "V√†ng" Nh√† ƒê·∫ßu T∆∞ C·∫ßn M·ªï X·∫ª Tr∆∞·ªõc Khi Xu·ªëng Ti·ªÅn</strong><br><br>Trong b·ªëi c·∫£nh th·ªã tr∆∞·ªùng b·∫•t ƒë·ªông s·∫£n cao c·∫•p t·∫°i TP.HCM ng√†y c√†ng c·∫°nh tranh, The Global City n·ªïi l√™n nh∆∞ m·ªôt ƒë·∫°i ƒë√¥ th·ªã ph·ª©c h·ª£p, mang trong m√¨nh t·∫ßm v√≥c qu·ªëc t·∫ø.<br><br>D·ª±a tr√™n b√°o c√°o th·ªã tr∆∞·ªùng t·ª´ Savills, c√≥ 3 y·∫øu t·ªë c·ªët l√µi nh√† ƒë·∫ßu t∆∞ c·∫ßn xem x√©t:<br><br>1Ô∏è‚É£ <strong>Ph√°p l√Ω minh b·∫°ch:</strong> D·ª± √°n ƒë√£ ho√†n thi·ªán gi·∫•y ch·ª©ng nh·∫≠n quy·ªÅn s·ª≠ d·ª•ng ƒë·∫•t v√† gi·∫•y ph√©p x√¢y d·ª±ng. ƒê√¢y l√† "t·∫•m khi√™n" v·ªØng ch·∫Øc b·∫£o v·ªá nh√† ƒë·∫ßu t∆∞ kh·ªèi r·ªßi ro.<br><br>2Ô∏è‚É£ <strong>Ti·ªÅm nƒÉng tƒÉng gi√° v∆∞·ª£t tr·ªôi:</strong> Ph√¢n khu shophouse Canal District, v·ªõi h·ªá th·ªëng k√™nh ƒë√†o 2km, ƒë∆∞·ª£c d·ª± b√°o s·∫Ω c√≥ t·ª∑ su·∫•t l·ª£i nhu·∫≠n h·∫•p d·∫´n, t∆∞∆°ng t·ª± nh∆∞ Ph√∫ M·ªπ H∆∞ng giai ƒëo·∫°n ƒë·∫ßu.<br><br>3Ô∏è‚É£ <strong>Uy t√≠n t·ª´ CƒêT:</strong> Masterise Homes, nh√† ph√°t tri·ªÉn BƒêS h√†ng hi·ªáu, l√† s·ª± b·∫£o ch·ª©ng cho ch·∫•t l∆∞·ª£ng v√† ti·∫øn ƒë·ªô d·ª± √°n.<br><br>=> V·ªõi s·ª± minh b·∫°ch v·ªÅ ph√°p l√Ω v√† ti·ªÅm nƒÉng tƒÉng tr∆∞·ªüng, The Global City l√† m·ªôt l·ª±a ch·ªçn ƒë·∫ßu t∆∞ ƒë√°ng c√¢n nh·∫Øc.`, fileName: 'Savills_Report_Q3_2025.pdf' },
                { id: 'deepspy-1', source: 'upload', query: null, type: 'PDF', content: `<strong>Ti√™u ƒë·ªÅ: C·∫≠p Nh·∫≠t Ch√≠nh S√°ch Hoa H·ªìng M·ªõi 2026: ƒê·ªôt Ph√° Thu Nh·∫≠p Cho Sales</strong><br><br>Anh em sales ch√∫ √Ω! üî•<br><br>Ch√≠nh s√°ch hoa h·ªìng m·ªõi s·∫Ω ch√≠nh th·ª©c √°p d·ª•ng t·ª´ 01/01/2026 v·ªõi nhi·ªÅu thay ƒë·ªïi ƒë·ªôt ph√°, ƒë·∫∑c bi·ªát l√† c∆° ch·∫ø t√≠nh th∆∞·ªüng cho c√°c h·ª£p ƒë·ªìng d√†i h·∫°n.<br><br>ƒê√¢y l√† c∆° h·ªôi tuy·ªát v·ªùi ƒë·ªÉ b·ª©t ph√° thu nh·∫≠p trong nƒÉm t·ªõi. Chi ti·∫øt ch√≠nh s√°ch ƒë√£ ƒë∆∞·ª£c g·ª≠i qua email, m·ªçi ng∆∞·ªùi check mail v√† chu·∫©n b·ªã tinh th·∫ßn "c√†y cu·ªëc" nh√©! üí™<br><br>#Sales #ChinhSachMoi #HoaHong2026`, fileName: 'Chinh_sach_hoa_hong_2026.pdf' }
            ];
            state.resources = JSON.parse(localStorage.getItem('credential_resources')) || [
                { id: 'resource-0', type: '·∫¢nh', source: 'upload', query: 'feedback_acme_corp.png', images: [{url: 'https://placehold.co/100x60/10b981/FFF?text=Thanks!'}], color: '#10b981', content: '<strong>Ti√™u ƒë·ªÅ: L·ªùi C·∫£m ∆†n Ch√¢n Th√†nh T·ª´ ƒê·ªôi Ng≈©!</strong><br><br>M·ªôt feedback nh·ªè t·ª´ kh√°ch h√†ng ACME Corp nh∆∞ng l√† ƒë·ªông l·ª±c l·ªõn lao cho c·∫£ team. üòä<br><br>S·ª± h√†i l√≤ng c·ªßa kh√°ch h√†ng ch√≠nh l√† kim ch·ªâ nam cho m·ªçi ho·∫°t ƒë·ªông c·ªßa ch√∫ng t√¥i. Xin ch√¢n th√†nh c·∫£m ∆°n s·ª± tin t∆∞·ªüng v√† ƒë·ªìng h√†nh c·ªßa qu√Ω kh√°ch!<br><br>#CustomerFeedback #Testimonial #ThankYou' },
                { id: 'resource-1', type: '·∫¢nh', source: 'google', query: 'business team meeting success', images: [{url: 'https://placehold.co/100x60/2563eb/FFF?text=Success'}, {url: 'https://placehold.co/100x60/4b5563/FFF?text=Meeting'}], color: '#2563eb', content: '<strong>Ti√™u ƒë·ªÅ: G·∫∑t H√°i Th√†nh C√¥ng M·ªõi!</strong><br><br>Bu·ªïi h·ªçp chi·∫øn l∆∞·ª£c h√¥m nay ƒë√£ di·ªÖn ra th√†nh c√¥ng t·ªët ƒë·∫πp v·ªõi nhi·ªÅu quy·∫øt s√°ch quan tr·ªçng ƒë∆∞·ª£c th√¥ng qua. üöÄ<br><br>S·∫µn s√†ng cho m·ªôt qu√Ω b√πng n·ªï ph√≠a tr∆∞·ªõc! C√πng nhau, ch√∫ng ta s·∫Ω ƒë·∫°t ƒë∆∞·ª£c nh·ªØng m·ª•c ti√™u l·ªõn lao h∆°n n·ªØa.<br><br>#Success #Teamwork #BusinessMeeting #Goals' }
            ];
            state.campaigns = JSON.parse(localStorage.getItem('credential_campaigns')) || defaultCampaigns;
            state.scheduledTasks = JSON.parse(localStorage.getItem('credential_scheduledTasks')) || [{ id: 'task-0', url: 'https://techcrunch.com/category/artificial-intelligence/', frequency: 'H√†ng tu·∫ßn', active: true }];
            state.taskLogs = JSON.parse(localStorage.getItem('credential_taskLogs')) || [
                { taskId: 'task-0', time: new Date().toLocaleString('vi-VN'), status: '<span class="text-green-400">Ho√†n th√†nh</span>', content: 'Ph√°t hi·ªán b√†i vi·∫øt m·ªõi: "OpenAI announces new partnership with Apple".' },
                { taskId: 'task-0', time: new Date(Date.now() - 86400000).toLocaleString('vi-VN'), status: '<span class="text-gray-400">Kh√¥ng c√≥ g√¨ m·ªõi</span>', content: 'Kh√¥ng c√≥ thay ƒë·ªïi n√†o ƒë∆∞·ª£c ph√°t hi·ªán.' }
            ];
        }

        function saveState() {
             localStorage.setItem('credential_guidelines', JSON.stringify(state.guidelines));
             localStorage.setItem('credential_deepspy', JSON.stringify(state.deepspyResults));
             localStorage.setItem('credential_resources', JSON.stringify(state.resources));
             localStorage.setItem('credential_campaigns', JSON.stringify(state.campaigns));
             localStorage.setItem('credential_scheduledTasks', JSON.stringify(state.scheduledTasks));
             localStorage.setItem('credential_taskLogs', JSON.stringify(state.taskLogs));
        }

        // --- CORE UI & LOGIC ---
        const views = { creation: document.getElementById('view-creation'), library: document.getElementById('view-library'), scheduler: document.getElementById('view-scheduler') };
        const navLinks = { creation: document.getElementById('nav-creation'), library: document.getElementById('nav-library'), scheduler: document.getElementById('nav-scheduler') };
        
        function switchView(viewName) {
            Object.values(views).forEach(v => v.classList.add('hidden'));
            Object.values(navLinks).forEach(l => l.classList.remove('active'));
            if(views[viewName]) views[viewName].classList.remove('hidden');
            if(navLinks[viewName]) navLinks[viewName].classList.add('active');
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            if(!toast) return;
            toast.querySelector('p').textContent = message;
            toast.className = `fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg transition-opacity duration-300 ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 3000);
        }

        async function simulateAITask(button, task) {
             const originalContent = button.innerHTML;
            button.innerHTML = '<div class="loader mx-auto"></div>';
            button.disabled = true;
            await new Promise(resolve => setTimeout(resolve, 1000));
            await task();
            button.innerHTML = originalContent;
            button.disabled = false;
        }
        
        // --- RENDER FUNCTIONS ---
        function renderAll() {
            renderGuidelineTable();
            renderDeepSpyTable();
            renderResourceTable();
            renderGuidelineSelector();
            renderKnowledgeSelector();
            renderCampaignList();
            renderScheduledTasksTable();
            document.getElementById('library-detail-view').classList.add('hidden');
            document.getElementById('library-list-view').classList.remove('hidden');
            document.getElementById('scheduler-detail-view').classList.add('hidden');
            document.getElementById('scheduler-list-view').classList.remove('hidden');
        }

        function renderExpandableContent(content) {
            const limit = 100; // Character limit
            if (content.length <= limit) {
                return `<div>${content}</div>`;
            }
            return `
                <div>
                    <div class="expandable-content">
                        ${content}
                    </div>
                    <button class="expand-btn">[Xem th√™m]</button>
                </div>
            `;
        }

        function renderGuidelineTable() { 
            document.getElementById('guideline-table-body').innerHTML = state.guidelines.map(g => `
                <tr>
                    <td>${g.url}</td>
                    <td>${g.style}</td>
                    <td>${renderExpandableContent(g.theme)}</td>
                    <td>
                        <div class="flex gap-4">
                           <button class="edit-btn text-blue-400 hover:text-blue-300" data-type="guideline" data-id="${g.id}"><i class="fas fa-edit"></i></button>
                           <button class="delete-btn text-red-400 hover:text-red-300" data-type="guideline" data-id="${g.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>`).join(''); 
        }

        function renderDeepSpyTable() { 
            document.getElementById('deepspy-table-body').innerHTML = state.deepspyResults.map(r => `
                <tr>
                    <td><span class="font-semibold px-2 py-1 rounded ${r.source === 'upload' ? 'bg-green-800 text-green-300' : 'bg-blue-800 text-blue-300'}">${r.source === 'upload' ? 'Upload' : 'Google'}</span></td>
                    <td>${renderExpandableContent(r.content)}</td>
                    <td>${renderExpandableContent(r.fileName)}</td>
                    <td>
                         <div class="flex gap-4">
                           <button class="edit-btn text-blue-400 hover:text-blue-300" data-type="deepspy" data-id="${r.id}"><i class="fas fa-edit"></i></button>
                           <button class="delete-btn text-red-400 hover:text-red-300" data-type="deepspy" data-id="${r.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>`).join(''); 
        }

        function renderResourceTable() {
            document.getElementById('resource-table-body').innerHTML = state.resources.map(r => `
                <tr>
                    <td><span class="font-semibold px-2 py-1 rounded ${r.source === 'upload' ? 'bg-green-800 text-green-300' : 'bg-blue-800 text-blue-300'}">${r.source === 'upload' ? 'Testimonial' : 'Google'}</span></td>
                    <td>
                        <div class="flex flex-wrap gap-2">
                            ${r.images.map(img => `<img src="${img.url}" class="w-20 h-12 object-cover rounded">`).join('')}
                        </div>
                    </td>
                    <td>${renderExpandableContent(r.query)}</td>
                    <td>${renderExpandableContent(r.content)}</td>
                    <td>
                        <div class="flex gap-4">
                           <button class="edit-btn text-blue-400 hover:text-blue-300" data-type="resource" data-id="${r.id}"><i class="fas fa-edit"></i></button>
                           <button class="delete-btn text-red-400 hover:text-red-300" data-type="resource" data-id="${r.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderGuidelineSelector() { document.getElementById('guideline-selector').innerHTML = `<option value="">Ch·ªçn Guideline</option>` + state.guidelines.map(g => `<option value="${g.id}">Guideline: ${g.url.split('/').pop() || g.url}</option>`).join(''); }
        function renderKnowledgeSelector() { document.getElementById('knowledge-selector').innerHTML = `<option value="">Ch·ªçn Ki·∫øn th·ª©c n·ªÅn</option>` + state.deepspyResults.map(k => `<option value="${k.id}">${k.fileName}</option>`).join(''); }
        
        function renderCampaignList() {
            document.getElementById('campaign-list').innerHTML = state.campaigns.map(campaign => `
                <div class="list-item p-4 rounded-lg" data-campaign-id="${campaign.id}">
                    <h3 class="font-bold">${campaign.name}</h3>
                    <p class="text-sm text-gray-400">${campaign.articles.length} b√†i vi·∫øt</p>
                </div>
            `).join('');
        }
        
        function renderArticlesForCampaign(campaignId) {
            const campaign = state.campaigns.find(c => c.id === campaignId);
            if (!campaign) return;
            const detailView = document.getElementById('library-detail-view');
            detailView.innerHTML = `
                <button class="mobile-back-btn btn-primary mb-4 py-2 px-4 rounded-md"><i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i Danh s√°ch</button>
                <h2 class="text-2xl font-bold text-white mb-4">${campaign.name}</h2>
                <div class="space-y-4">
                    ${campaign.articles.map(article => {
                         const articleContent = article.content ? `
                             <div class="text-gray-300 space-y-4 mt-4">
                                 <div class="expandable-content">${article.content}</div>
                                 <button class="expand-btn">[Xem th√™m]</button>
                             </div>` : '';
                         return `
                             <div class="article">
                                 <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                     <div>
                                         <p class="font-semibold text-white">${article.title}</p>
                                         <div class="mt-2 flex flex-wrap gap-2">
                                             ${article.resources.map(resId => { const resource = state.resources.find(r => r.id === resId); return resource ? `<span class="resource-tag"><i class="fas ${resource.source === 'upload' ? 'fa-quote-left text-green-400' : 'fa-image text-blue-400'}"></i> ${resource.query}</span>` : ''; }).join('')}
                                         </div>
                                          ${articleContent}
                                     </div>
                                     <div class="flex flex-col items-start sm:items-end gap-2">
                                         <div class="flex items-center gap-2">
                                             <span class="status-badge ${article.status === 'ƒê√£ ƒëƒÉng' ? 'status-published' : 'status-draft'}">${article.status}</span>
                                             <input type="datetime-local" class="input-field text-sm p-1 rounded-md bg-gray-800 w-full" value="${article.schedule}">
                                         </div>
                                         <div class="flex items-center gap-2">
                                             <button class="manage-resources-btn text-sm bg-gray-600 hover:bg-gray-700 font-semibold py-1 px-3 rounded-md" data-campaign-id="${campaign.id}" data-article-id="${article.id}">T√†i nguy√™n</button>
                                             <button class="text-xs bg-blue-600 hover:bg-blue-700 font-semibold py-1 px-3 rounded-md">L∆∞u</button>
                                         </div>
                                     </div>
                                 </div>
                             </div>
                         `}).join('')
                    }
                </div>
            `;
        }

        function renderScheduledTasksTable() {
             document.getElementById('scheduled-tasks-body').innerHTML = state.scheduledTasks.map((task, index) => `
                <tr class="list-item" data-task-id="${task.id}">
                     <td>${task.url.replace('https://','').replace('www.','')}</td>
                    <td>${task.frequency}</td>
                    <td>
                        <label class="toggle-switch">
                          <input type="checkbox" data-task-index="${index}" ${task.active ? 'checked' : ''}>
                          <span class="slider"></span>
                        </label>
                    </td>
                </tr>
            `).join('');
        }

        function renderLogsForTask(taskId) {
            const task = state.scheduledTasks.find(t => t.id === taskId);
            const detailView = document.getElementById('scheduler-detail-view');
            const logs = state.taskLogs.filter(log => log.taskId === taskId);
            
            detailView.innerHTML = `
                <button class="mobile-back-btn btn-primary mb-4 py-2 px-4 rounded-md"><i class="fas fa-arrow-left mr-2"></i> Quay l·∫°i Danh s√°ch</button>
                <h2 class="text-2xl font-bold text-white mb-4">Logs cho: ${task.url.replace('https://www.','').split('/')[0]}</h2>
                <div class="space-y-4">
                     ${ (logs.length > 0) 
                         ? logs.map(log => `<div class="article !p-3"><p class="text-sm text-gray-400">${log.time} - ${log.status}</p><div class="text-white mt-1">${renderExpandableContent(log.content)}</div></div>`).join('') 
                         : `<div class="text-center text-gray-500">Kh√¥ng c√≥ log n√†o.</div>`
                       }
                </div>`;
        }
        
        function openSelectionModal(type, article) {
            currentArticleSelection.type = type;
            const modalTitle = document.getElementById('modal-title');
            const content = document.getElementById('modal-selection-content');
            let html = '';

            if (type === 'resource') {
                modalTitle.innerText = 'Ch·ªçn T√†i nguy√™n ·∫¢nh';
                html = '<div class="grid grid-cols-2 sm:grid-cols-4 gap-4">';
                state.resources.forEach((item) => {
                    const checked = article.resources.includes(item.id) ? 'checked' : '';
                    html += `<label class="relative cursor-pointer"><input type="checkbox" value="${item.id}" ${checked} class="sr-only peer"><img src="${item.images[0].url}" class="rounded-md peer-checked:ring-2 peer-checked:ring-blue-500"><div class="absolute top-2 right-2 bg-white/70 peer-checked:bg-blue-500 rounded-full w-5 h-5 flex items-center justify-center text-black"><i class="fas fa-check opacity-0 peer-checked:opacity-100"></i></div></label>`;
                });
                html += '</div>';
            }
            content.innerHTML = html;
            document.getElementById('selection-modal').classList.remove('hidden');
        }

        function openEditModal(type, id) { /* ... same as before ... */ }
        
        // --- EVENT LISTENERS ---
        function attachAllEventListeners() {
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                showToast('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!');
                loginView.classList.add('hidden');
                appContainer.classList.remove('hidden');
                initializeApp();
            });
        }

        function initializeApp() {
            loadState();
            switchView('creation');
            renderAll();
            attachAppEventListeners();
        }

        function attachAppEventListeners() {
            // Main app event delegation
            const mainContent = document.querySelector('main');
            mainContent.addEventListener('click', (e) => {
                const expandBtn = e.target.closest('.expand-btn');
                if (expandBtn) {
                    const content = expandBtn.previousElementSibling;
                    content.classList.toggle('expanded');
                    expandBtn.textContent = content.classList.contains('expanded') ? '[Thu g·ªçn]' : '[Xem th√™m]';
                }
                // ... (other delegations for edit, delete, etc.)
            });

            // Specific listeners that need to be re-attached
            Object.keys(navLinks).forEach(key => navLinks[key].addEventListener('click', (e) => { e.preventDefault(); switchView(key); renderAll();}));
            document.querySelectorAll('#view-creation .tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('#view-creation .tab-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    document.querySelectorAll('#view-creation .tab-pane').forEach(content => content.classList.add('hidden'));
                    document.getElementById(`tab-content-${button.dataset.tab}`).classList.remove('hidden');
                });
            });
            
            document.getElementById('library-content').addEventListener('click', e => {
                const campaignHeader = e.target.closest('.list-item');
                const backBtn = e.target.closest('.mobile-back-btn');
                const listView = document.getElementById('library-list-view');
                const detailView = document.getElementById('library-detail-view');

                if (campaignHeader) {
                    listView.classList.add('hidden');
                    detailView.classList.remove('hidden');
                    const campaignId = parseInt(campaignHeader.dataset.campaignId);
                    renderArticlesForCampaign(campaignId);
                }
                if (backBtn) {
                    detailView.classList.add('hidden');
                    listView.classList.remove('hidden');
                }
            });

            document.getElementById('scheduler-content').addEventListener('click', e => {
                const taskItem = e.target.closest('.list-item');
                const backBtn = e.target.closest('.mobile-back-btn');
                const listView = document.getElementById('scheduler-list-view');
                const detailView = document.getElementById('scheduler-detail-view');
                
                if (taskItem) {
                    listView.classList.add('hidden');
                    detailView.classList.remove('hidden');
                    const taskId = taskItem.dataset.taskId;
                    renderLogsForTask(taskId);
                }
                if (backBtn) {
                    detailView.classList.add('hidden');
                    listView.classList.remove('hidden');
                }
            });
        }

        attachAllEventListeners();
    });
    </script>
</body>
</html>

